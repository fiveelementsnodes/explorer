import{d as E,j as S,o as d,m as i,F as R,q as A,n as t,K as y,X as O,H as q,J as G,l as J,i as k,k as X,ct as Q,ab as Y,r as Z,t as a,L as I,M as g,w as tt,y as et,p,G as N,x as V,P as C,ad as D}from"./index-69d08b4b.js";import{b as F}from"./route-block-83d24a4e.js";const st={class:"flex items-center justify-evenly gap-0.5"},ot=["data-tip"],at=E({__name:"UptimeBar",props:{blocks:{type:Array},validator:{type:String}},setup(j){const h=j,b=S(()=>{const u=Array(50).fill({height:0,color:"bg-secondary"});return h.blocks&&h.blocks.forEach(_=>{var m;const v=(m=_.signatures)==null?void 0:m.findIndex(x=>x.validator_address===h.validator);u.push({height:_.height,color:v>-1?"bg-green-500":"bg-red-500"}),u.shift()}),u});return(u,_)=>(d(),i("div",st,[(d(!0),i(R,null,A(b.value,(v,m)=>(d(),i("div",{class:"cursor-default",key:m},[t("div",{class:y(["tooltip",v.color]),"data-tip":v.height,style:{width:"4px"}}," Â  ",10,ot)]))),128))]))}}),lt={class:"tabs tabs-boxed bg-transparent mb-4"},rt={class:"tab text-gray-400 capitalize"},ct={class:"bg-base-100 px-5 pt-5"},nt={class:"flex items-center gap-x-4"},dt={key:0,class:"alert alert-warning my-4"},it={class:"flex items-center justify-between py-0 w-[298px]"},ut={class:"truncate text-sm"},ht={class:"ml-1 text-black dark:text-white"},_t={key:0,class:"badge badge-sm bg-transparent border-0 text-red-500 font-bold"},mt={key:1,class:"badge badge-sm bg-transparent text-green-600 border-0 font-bold"},pt={class:"table table-compact w-full mt-5"},bt={class:"capitalize"},vt={class:"text-right"},ft={class:"text-right"},kt={class:"text-right"},xt={class:"hover"},yt={class:"truncate max-w-sm"},wt={class:"text-right"},$t=["data-tip"],Nt={key:0},Ct=["data-tip"],St={class:"text-xs text-right"},jt={key:0,class:"text-right"},Bt={class:"text-right"},zt={class:"capitalize"},Rt={colspan:"2",class:"text-right"},At=["data-tip"],Lt={class:"ml-2 btn btn-error btn-xs"},Pt=t("td",{colspan:"8"},null,-1),Kt=t("div",{class:"h-6"},null,-1),Tt=E({__name:"index",props:["chain"],setup(j){const h=O(),b=q(),u=G(),_=J(),v=k(0),m=k([]),x=k(""),B=k(!0),w=k({}),z=k({}),L=S(()=>x?h.validators.filter(s=>s.description.moniker.indexOf(x.value)>-1):h.validators),P=S(()=>{var s,o,r;if(_.isConsumerChain){h.loadKeyRotationFromLocalstorage((r=(o=(s=u.latest)==null?void 0:s.block)==null?void 0:o.header)==null?void 0:r.chain_id);const l=Number(w.value.signed_blocks_window||0);return L.value.map(n=>{const c=h.findRotatedHexAddress(n.consensus_pubkey),f=z.value[c];return{v:n,signing:f,hex:C.toBase64(C.fromHex(c)),uptime:f&&l>0?(l-Number(f.missed_blocks_counter))/l:void 0}})}else{const l=Number(w.value.signed_blocks_window||0);return L.value.map(n=>{const c=z.value[D(n.consensus_pubkey)];return{v:n,signing:c,hex:C.toBase64(C.fromHex(D(n.consensus_pubkey))),uptime:c&&l>0?(l-Number(c.missed_blocks_counter))/l:void 0}})}});X(()=>{B.value=!0,u.fetchLatest().then(s=>{var l,e,n;let o=s;((l=u.recents)==null?void 0:l.findIndex(c=>c.block_id.hash===s.block_id.hash))>-1&&(o=((e=u.recents)==null?void 0:e.at(0))||s),v.value=Number(o.block.header.height),m.value.unshift(o.block.last_commit);const r=Number(((n=o.block.header)==null?void 0:n.height)||0);if(r>50){let c=Promise.resolve();for(let f=r-1;f>r-50;f-=1)c=c.then(()=>new Promise((U,Ht)=>{B.value&&T.value.length<50&&u.fetchBlock(f).then(W=>{m.value.unshift(W.block.last_commit),U()})}))}}),K(),_.rpc.getSlashingParams().then(s=>{w.value=s.params})});function K(){_.rpc.getSlashingSigningInfos().then(s=>{var o;(o=s.info)==null||o.forEach(r=>{z.value[Q(r.address)]=r})})}const T=S(()=>{var r;const s=u.recents.map(l=>l.block.last_commit);s.length>1&&Number(((r=s.at(s.length-1))==null?void 0:r.height)||0)%10===7&&K();const o=[...m.value,...s];return o.length>50?o.slice(o.length-50):o});Y(()=>{B.value=!1});const $=k("2");function H(s){$.value=s}function M(){var s,o,r;h.fetchAllKeyRotation((r=(o=(s=u.latest)==null?void 0:s.block)==null?void 0:o.header)==null?void 0:r.chain_id)}return(s,o)=>{const r=Z("RouterLink");return d(),i("div",null,[t("div",lt,[t("a",{class:y(["tab text-gray-400 capitalize",{"tab-active":$.value==="3"}]),onClick:o[0]||(o[0]=l=>H("3"))},a(s.$t("uptime.overall")),3),t("a",{class:y(["tab text-gray-400 capitalize",{"tab-active":$.value==="2"}]),onClick:o[1]||(o[1]=l=>H("2"))},a(s.$t("module.blocks")),3),I(r,{to:`/${j.chain}/uptime/customize`},{default:g(()=>[t("a",rt,a(s.$t("uptime.customize")),1)]),_:1},8,["to"])]),t("div",ct,[t("div",nt,[tt(t("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=l=>x.value=l),placeholder:"Keywords to filter validators",class:"input input-sm w-full flex-1 border border-gray-200 dark:border-gray-600"},null,512),[[et,x.value]]),p(_).isConsumerChain?(d(),i("button",{key:0,class:"btn btn-sm btn-primary",onClick:M},"Load Rotated Keys")):N("",!0)]),p(_).isConsumerChain&&Object.keys(p(h).keyRotation).length===0?(d(),i("div",dt," Note: Please load rotated keys to see the correct uptime ")):N("",!0),t("div",{class:y(["flex flex-row flex-wrap gap-x-4 mt-4 justify-center",$.value==="2"?"":"hidden"])},[(d(!0),i(R,null,A(P.value,({v:l,signing:e,hex:n},c)=>(d(),i("div",{key:c},[t("div",it,[t("label",ut,[t("span",ht,a(c+1)+"."+a(l.description.moniker),1)]),Number((e==null?void 0:e.missed_blocks_counter)||0)>10?(d(),i("div",_t,a(e==null?void 0:e.missed_blocks_counter),1)):(d(),i("div",mt,a(e==null?void 0:e.missed_blocks_counter),1))]),I(at,{blocks:T.value,validator:n},null,8,["blocks","validator"])]))),128))],2),t("div",{class:y([$.value==="3"?"":"hidden","overflow-x-auto"])},[t("table",pt,[t("thead",bt,[t("tr",null,[t("td",null,a(s.$t("account.validator")),1),t("td",vt,a(s.$t("module.uptime")),1),t("td",null,a(s.$t("uptime.last_jailed_time")),1),t("td",ft,a(s.$t("uptime.signed_precommits")),1),t("td",kt,a(s.$t("uptime.start_height")),1),t("td",null,a(s.$t("uptime.tombstoned")),1)])]),(d(!0),i(R,null,A(P.value,({v:l,signing:e,uptime:n},c)=>(d(),i("tr",xt,[t("td",null,[t("div",yt,a(c+1)+". "+a(l.description.moniker),1)]),t("td",wt,[e?(d(),i("span",{key:0,class:y(["",n&&n>.95?"text-green-500":"text-red-500"])},[t("div",{class:"tooltip","data-tip":`${e.missed_blocks_counter} missing blocks`},a(p(b).percent(n)),9,$t)],2)):N("",!0)]),t("td",null,[e&&!e.jailed_until.startsWith("1970")?(d(),i("span",Nt,[t("div",{class:"tooltip","data-tip":p(b).toDay(e==null?void 0:e.jailed_until,"long")},[t("span",null,a(p(b).toDay(e==null?void 0:e.jailed_until,"from")),1)],8,Ct)])):N("",!0)]),t("td",St,[e&&e.jailed_until.startsWith("1970")?(d(),i("span",jt,a(p(b).percent(Number(e.index_offset)/(v.value-Number(e.start_height)))),1)):N("",!0),V(" "+a(e==null?void 0:e.index_offset),1)]),t("td",Bt,a(e==null?void 0:e.start_height),1),t("td",zt,a(e==null?void 0:e.tombstoned),1)]))),256)),t("tfoot",null,[t("tr",null,[t("td",Rt,[V(a(s.$t("uptime.minimum_uptime"))+": ",1),t("span",{class:"lowercase tooltip","data-tip":`Window size: ${w.value.signed_blocks_window}`},[t("span",Lt,a(p(b).percent(w.value.min_signed_per_window)),1)],8,At)]),Pt])])])],2),Kt])])}}});typeof F=="function"&&F(Tt);export{Tt as default};
